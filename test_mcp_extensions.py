#!/usr/bin/env python3
# ZORA MODULE HEADER

"""
Module Name: test_mcp_extensions
Generated by ZORA SYSTEM ‚Äì All rights reserved.
Test MCP Extensions Integration for ZORA CORE
"""

import sys
import os
import json
from datetime import datetime

sys.path.insert(0, '/home/ubuntu/repos/ZORA-CORE')

def test_mcp_extensions():
    """Test all MCP extensions integration"""
    print("üß™ TESTING MCP EXTENSIONS INTEGRATION")
    print("=" * 50)
    
    try:
        from mcp_extensions import MCP_EXTENSIONS, ping_all_extensions, get_all_extensions
        
        print(f"‚úÖ Successfully imported MCP extensions module")
        print(f"üìä Total MCP extensions available: {len(MCP_EXTENSIONS)}")
        
        print("\nüîå Available MCP Extensions:")
        for name, extension in MCP_EXTENSIONS.items():
            status = "‚úÖ Available" if extension else "‚ùå Not Available"
            print(f"  {name}: {status}")
        
        print("\nüèì Testing ping_all_extensions():")
        ping_results = ping_all_extensions("ZORA CORE MCP Integration Test")
        
        for name, result in ping_results.items():
            if isinstance(result, dict):
                status = result.get('status', 'unknown')
                if status == 'synchronized':
                    print(f"  ‚úÖ {name}: {status}")
                elif status == 'unavailable':
                    print(f"  ‚ö†Ô∏è {name}: {status}")
                else:
                    print(f"  ‚ùì {name}: {status}")
            else:
                print(f"  ‚ùå {name}: Invalid response")
        
        print("\nüõ†Ô∏è Testing Individual Extension Capabilities:")
        for name, extension in MCP_EXTENSIONS.items():
            if extension and hasattr(extension, 'get_extension_status'):
                try:
                    status = extension.get_extension_status()
                    capabilities = status.get('capabilities', [])
                    print(f"  üîó {name}: {len(capabilities)} capabilities")
                    for cap in capabilities[:3]:  # Show first 3 capabilities
                        print(f"    - {cap}")
                except Exception as e:
                    print(f"  ‚ùå {name}: Error getting status - {e}")
        
        print("\nüë§ Testing User Profile Integration:")
        for name, extension in MCP_EXTENSIONS.items():
            if extension and hasattr(extension, 'user_name'):
                user_name = getattr(extension, 'user_name', 'Not Set')
                organization = getattr(extension, 'organization', 'Not Set')
                print(f"  üè¢ {name}: {user_name} @ {organization}")
        
        print("\nüéâ MCP EXTENSIONS INTEGRATION TEST COMPLETED")
        return True
        
    except ImportError as e:
        print(f"‚ùå Import Error: {e}")
        return False
    except Exception as e:
        print(f"‚ùå Test Error: {e}")
        return False

def test_mcp_extension_discovery():
    """Test MCP extension auto-discovery"""
    print("\nüîç TESTING MCP EXTENSION AUTO-DISCOVERY")
    print("=" * 50)
    
    try:
        from mcp_extensions import get_all_extensions
        
        extensions = get_all_extensions()
        print(f"üìä Discovered {len(extensions)} MCP extensions")
        
        extension_types = {}
        for name, extension in extensions.items():
            if extension and hasattr(extension, 'extension_type'):
                ext_type = getattr(extension, 'extension_type', 'unknown')
                if ext_type not in extension_types:
                    extension_types[ext_type] = []
                extension_types[ext_type].append(name)
        
        print("\nüìã Extension Types:")
        for ext_type, names in extension_types.items():
            print(f"  {ext_type}: {len(names)} extensions")
            for name in names[:3]:  # Show first 3
                print(f"    - {name}")
        
        return True
        
    except Exception as e:
        print(f"‚ùå Discovery Test Error: {e}")
        return False

if __name__ == "__main__":
    print("üöÄ ZORA CORE MCP EXTENSIONS TEST SUITE")
    print(f"‚è∞ Test started at: {datetime.utcnow().isoformat()}Z")
    print()
    
    test1_result = test_mcp_extensions()
    test2_result = test_mcp_extension_discovery()
    
    print("\n" + "=" * 50)
    print("üìä TEST RESULTS SUMMARY:")
    print(f"  MCP Extensions Integration: {'‚úÖ PASSED' if test1_result else '‚ùå FAILED'}")
    print(f"  MCP Extension Discovery: {'‚úÖ PASSED' if test2_result else '‚ùå FAILED'}")
    
    if test1_result and test2_result:
        print("\nüéâ ALL TESTS PASSED - MCP EXTENSIONS READY FOR ZORA CORE")
    else:
        print("\n‚ö†Ô∏è SOME TESTS FAILED - CHECK INTEGRATION")
    
    print(f"\n‚è∞ Test completed at: {datetime.utcnow().isoformat()}Z")
