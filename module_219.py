# ZORA MODULE HEADER
# Filename: module_219.py
# Updated: 2025-06-26T00:44:09.014508 UTC

"""
Module Name: 219
Generated by ZORA SYSTEM – All rights reserved.
"""

import hashlib
from datetime import datetime


class ZoraPhysicalAddressEngine:
    def __init__(self):
        self.addresses = [
            {
                "address": "Fjordbakken 50, Dyves Bro, 4700 Næstved",
                "purpose": "Legal",
                "type": "HQ",
                "active": True,
                "updated": "2025-07-25"
            }
        ]
        self.purposes = [
            "Legal", "Postal", "Datacenter", "PublicRep", "Storage", "Backup"
        ]
        self.encryption_key = "ZORA_CORE_SOUL_LOCK_KEY"

    def encrypt(self, input_string):
        base = (input_string + self.encryption_key).encode("utf-8")
        return hashlib.sha256(base).hexdigest()

    def add_address(self, address_str, purpose, valid_from=None, valid_until=None):
        if purpose not in self.purposes:
            raise ValueError("Ugyldigt formål.")
        encrypted_address = self.encrypt(address_str)
        self.addresses.append({
            "original": address_str,
            "encrypted": encrypted_address,
            "purpose": purpose,
            "valid_from": valid_from or str(datetime.utcnow()),
            "valid_until": valid_until
        })

    def get_all_addresses(self):
        return self.addresses

    def get_active_addresses(self, purpose_filter=None):
        now = datetime.utcnow()
        results = []
        for entry in self.addresses:
            if purpose_filter and entry["purpose"] != purpose_filter:
                continue
            if entry["valid_until"] and datetime.strptime(entry["valid_until"], "%Y-%m-%d") < now:
                continue
            results.append(entry)
        return results
