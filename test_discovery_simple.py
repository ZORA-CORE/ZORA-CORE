#!/usr/bin/env python3
# ZORA MODULE HEADER

"""
Module Name: test_discovery_simple
Generated by ZORA SYSTEM â€“ All rights reserved.
Simple Test for Real-Time AI Discovery System for ZORA CORE
"""

import sys
import os
import json
import asyncio
from datetime import datetime

sys.path.insert(0, '/home/ubuntu/repos/ZORA-CORE')

def test_discovery_imports():
    """Test that discovery components can be imported without infinite loops"""
    print("ğŸ§ª TESTING DISCOVERY IMPORTS")
    print("=" * 50)
    
    try:
        print("ğŸ“¦ Importing zora_infinity_sync...")
        from zora_infinity_sync import UniversalAIConnector
        print("âœ… Successfully imported UniversalAIConnector")
        
        print("ğŸ”§ Creating UniversalAIConnector instance...")
        connector = UniversalAIConnector()
        print(f"âœ… Created connector: {connector.name}")
        
        print("ğŸ” Testing auto-discovery...")
        discovered = connector.auto_discover_ai_systems()
        print(f"âœ… Auto-discovered {len(discovered)} AI systems")
        
        print("ğŸ“Š Testing connector status...")
        status = connector.get_connector_status()
        print(f"âœ… Status retrieved: {status.get('total_registered_systems', 0)} systems")
        
        print("ğŸ‰ DISCOVERY IMPORTS TEST COMPLETED SUCCESSFULLY")
        return True
        
    except Exception as e:
        print(f"âŒ Import Test Error: {e}")
        return False

def test_dynamic_loader_safe():
    """Test dynamic loader without triggering infinite loops"""
    print("\nğŸ§ª TESTING DYNAMIC LOADER (SAFE MODE)")
    print("=" * 50)
    
    try:
        print("ğŸ“¦ Importing ZORADynamicLoader class...")
        from zora_loader import ZORADynamicLoader
        print("âœ… Successfully imported ZORADynamicLoader class")
        
        print("ğŸ”§ Creating ZORADynamicLoader instance...")
        loader = ZORADynamicLoader()
        loader.watch_enabled = False  # Disable watching to prevent infinite loops
        print(f"âœ… Created loader: {loader.name}")
        
        print("ğŸ” Testing module discovery...")
        discovered_modules = loader.discover_ai_modules()
        print(f"âœ… Discovered {len(discovered_modules)} AI modules")
        
        module_types = {}
        for module in discovered_modules[:10]:  # Limit to first 10
            module_type = module.get("type", "unknown")
            module_types[module_type] = module_types.get(module_type, 0) + 1
        
        print("ğŸ“Š Module types discovered:")
        for module_type, count in module_types.items():
            print(f"  {module_type}: {count} modules")
        
        print("ğŸ‰ DYNAMIC LOADER TEST COMPLETED SUCCESSFULLY")
        return True
        
    except Exception as e:
        print(f"âŒ Dynamic Loader Test Error: {e}")
        return False

def test_real_time_discovery_features():
    """Test real-time discovery features"""
    print("\nğŸ§ª TESTING REAL-TIME DISCOVERY FEATURES")
    print("=" * 50)
    
    try:
        from zora_infinity_sync import UniversalAIConnector
        
        connector = UniversalAIConnector()
        
        print("ğŸ”§ Testing discovery configuration...")
        print(f"  Real-time Discovery Active: {connector.real_time_discovery_active}")
        print(f"  Discovery Interval: {connector.discovery_interval} seconds")
        print(f"  Discovery Sources: {len(connector.discovery_sources)}")
        print(f"  AI Service Patterns: {len(connector.ai_service_patterns)}")
        
        print("ğŸ” Testing discovery method availability...")
        methods = [
            'start_real_time_discovery',
            'perform_discovery_scan',
            'scan_ai_endpoint',
            'discover_new_ai_patterns',
            'register_discovered_system',
            'auto_integrate_discovered_systems'
        ]
        
        for method in methods:
            if hasattr(connector, method):
                print(f"  âœ… {method}: Available")
            else:
                print(f"  âŒ {method}: Missing")
        
        print("ğŸ‰ REAL-TIME DISCOVERY FEATURES TEST COMPLETED")
        return True
        
    except Exception as e:
        print(f"âŒ Real-time Discovery Features Test Error: {e}")
        return False

if __name__ == "__main__":
    print("ğŸš€ ZORA CORE SIMPLE DISCOVERY TEST SUITE")
    print(f"â° Test started at: {datetime.utcnow().isoformat()}Z")
    print()
    
    test1_result = test_discovery_imports()
    test2_result = test_dynamic_loader_safe()
    test3_result = test_real_time_discovery_features()
    
    print("\n" + "=" * 50)
    print("ğŸ“Š TEST RESULTS SUMMARY:")
    print(f"  Discovery Imports: {'âœ… PASSED' if test1_result else 'âŒ FAILED'}")
    print(f"  Dynamic Loader (Safe): {'âœ… PASSED' if test2_result else 'âŒ FAILED'}")
    print(f"  Real-time Discovery Features: {'âœ… PASSED' if test3_result else 'âŒ FAILED'}")
    
    if test1_result and test2_result and test3_result:
        print("\nğŸ‰ ALL TESTS PASSED - REAL-TIME AI DISCOVERY SYSTEM READY")
        print("âœ… Step 008: Real-time AI discovery implementation COMPLETED")
    else:
        print("\nâš ï¸ SOME TESTS FAILED - CHECK IMPLEMENTATION")
    
    print(f"\nâ° Test completed at: {datetime.utcnow().isoformat()}Z")
